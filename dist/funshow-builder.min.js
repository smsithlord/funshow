class FunShowSplash extends FunShowEventEmitter{constructor(container){super();this.container=container;this.givenContainer=this.container;if(!this.container){this.container=document.createElement("div");document.body.appendChild(this.container)}this.injectCSS();this.injectHTML();this.bindEvents()}destroy(){this.emit("destroy");const styleElement=document.head.querySelector("style[data-funshow-splash-style]");if(styleElement){document.head.removeChild(styleElement)}this.container.innerHTML="";this.off();if(this.container!=this.givenContainer){this.container.remove()}this.givenContainer=null;this.container=null}injectCSS(){const style=document.createElement("style");style.setAttribute("data-funshow-splash-style","");const styles=`\n            .funshow-splash-wrapper {\n                font-family: Arial, sans-serif;\n                background-color: #121212;\n                color: #ffffff;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: space-between;\n                min-height: 100vh;\n                margin: 0;\n                padding: 2rem 0;\n                box-sizing: border-box;\n                width: 100%;\n                height: 100%;\n            }\n\n            .funshow-splash-main-content {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                flex-grow: 1;\n            }\n\n            .funshow-splash-app-header {\n                display: flex;\n                align-items: center;\n                font-size: 4rem;\n                margin-bottom: 2rem;\n                animation: funshow-splash-fadeIn 1s ease-out;\n            }\n\n            .funshow-splash-app-icon {\n                width: 100px;\n                height: 100px;\n                margin-right: 1rem;\n            }\n\n            .funshow-splash-instructions {\n                text-align: center;\n                margin-bottom: 2rem;\n                max-width: 600px;\n                animation: funshow-splash-fadeIn 1s ease-out 0.5s both;\n            }\n\n            .funshow-splash-options {\n                display: flex;\n                gap: 2rem;\n            }\n\n            .funshow-splash-option {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                padding: 1.5rem;\n                border-radius: 10px;\n                background-color: #1e1e1e;\n                cursor: pointer;\n                transition: transform 0.3s ease, box-shadow 0.3s ease;\n                animation: funshow-splash-fadeIn 1s ease-out 1s both;\n            }\n\n            .funshow-splash-option:hover {\n                transform: translateY(-5px);\n                box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);\n            }\n\n            .funshow-splash-option svg {\n                width: 64px;\n                height: 64px;\n                margin-bottom: 1rem;\n            }\n\n            .funshow-splash-option-label {\n                font-size: 1.5rem;\n            }\n\n            .funshow-splash-help-option {\n                display: flex;\n                align-items: center;\n                padding: 0.75rem 1.5rem;\n                border-radius: 5px;\n                background-color: #1e1e1e;\n                margin-top: 40px;\n                cursor: pointer;\n                transition: transform 0.3s ease, box-shadow 0.3s ease;\n                animation: funshow-splash-fadeIn 1s ease-out 1.5s both;\n            }\n\n            .funshow-splash-help-option:hover {\n                transform: translateY(-3px);\n                box-shadow: 0 3px 10px rgba(255, 255, 255, 0.1);\n            }\n\n            .funshow-splash-help-option svg {\n                width: 24px;\n                height: 24px;\n                margin-right: 0.5rem;\n            }\n\n            .funshow-splash-help-option-label {\n                font-size: 1rem;\n            }\n\n            @keyframes funshow-splash-fadeIn {\n                from { opacity: 0; transform: translateY(20px); }\n                to { opacity: 1; transform: translateY(0); }\n            }\n\n            .funshow-splash-footer {\n                font-size: 0.8rem;\n                text-align: center;\n                opacity: 0.7;\n                margin-top: 2rem;\n            }\n\n            .funshow-splash-footer-links {\n                display: flex;\n                justify-content: center;\n                gap: 20px;\n                margin-bottom: 15px;\n            }\n\n            .funshow-splash-footer-link {\n                display: inline-flex;\n                align-items: center;\n                color: #ffffff;\n                text-decoration: none;\n                transition: color 0.3s ease;\n            }\n\n            .funshow-splash-footer-link:hover {\n                color: #4a90e2;\n            }\n\n            .funshow-splash-footer-link svg {\n                width: 16px;\n                height: 16px;\n                margin-left: 5px;\n            }\n\n            .funshow-splash-footer-link span {\n                font-weight: bold;\n            }\n        `;style.textContent=styles;document.head.appendChild(style)}injectHTML(){this.container.innerHTML=`\n            <div class="funshow-splash-wrapper">\n                <div class="funshow-splash-main-content">\n                    <div class="funshow-splash-app-header">\n                        <svg class="funshow-splash-app-icon" viewBox="18 21 33 22" xmlns="http://www.w3.org/2000/svg">\n                            <g fill="currentColor">\n                                <path d="M20 25h22v15H20z" stroke="currentColor" stroke-width="1" fill="none"/>\n                                <path d="M24 28l16 8-16 8V28z"/>\n                                <circle cx="48" cy="24" r="3"/>\n                                <circle cx="48" cy="32" r="3"/>\n                                <circle cx="48" cy="40" r="3"/>\n                            </g>\n                        </svg>\n                        <span>FunShow</span>\n                    </div>\n\n                    <div class="funshow-splash-instructions">\n                        Would you like to create a new show or view existing ones?\n                    </div>\n\n                    <div class="funshow-splash-options">\n                        <div class="funshow-splash-option" data-option="builder">\n                            <svg viewBox="19 19 33 25" xmlns="http://www.w3.org/2000/svg" class="funshow-toolbar-icon-builder">\n                                <g fill="currentColor">\n                                    <rect x="22" y="22" width="20" height="20" style="fill: #ffffff;"/>\n                                    <path d="M26 26h12M26 32h12M26 38h12" stroke-width="1" fill="none" style="stroke: #ffffff"/>\n                                    <path d="M26 26h12M26 32h12M26 38h12" stroke-width="1" style="stroke: #000000;"/>\n                                    <path d="M46 22v20M50 26v12" stroke-width="2" fill="none" style="stroke: #ffffff"/>\n                                    <circle cx="46" cy="22" r="2" style="fill: #ffffff"/>\n                                    <circle cx="46" cy="42" r="2" style="fill: #ffffff"/>\n                                    <circle cx="50" cy="26" r="2" style="fill: #ffffff"/>\n                                    <circle cx="50" cy="38" r="2" style="fill: #ffffff"/>\n                                </g>\n                            </svg>\n                            <span class="funshow-splash-option-label">Builder</span>\n                        </div>\n                        <div class="funshow-splash-option" data-option="viewer">\n                            <svg viewBox="8 11 48 42" xmlns="http://www.w3.org/2000/svg">\n                                <g fill="none" stroke="currentColor" stroke-width="2">\n                                    <ellipse cx="32" cy="32" rx="16" ry="10"/>\n                                    <path d="M20 32h-8M52 32h-8" stroke="currentColor" stroke-width="2"/>\n                                    <circle cx="32" cy="32" r="5" stroke-width="3"/>\n                                </g>\n                            </svg>\n                            <span class="funshow-splash-option-label">Viewer</span>\n                        </div>\n                    </div>\n\n                    <div class="funshow-splash-help-option" data-option="help">\n                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>\n                        </svg>\n                        <span class="funshow-splash-help-option-label">Help</span>\n                    </div>\n                </div>\n\n                <div class="funshow-splash-footer">\n                    <div class="funshow-splash-footer-links">\n                        <a href="https://x.com/anarchyarcade" target="_blank" rel="noopener noreferrer" class="funshow-splash-footer-link funshow-splash-x-link">\n                            <span>Created by SM Sith Lord</span>\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>\n                            </svg>\n                        </a>\n                        <a href="https://github.com/smsithlord/funshow" target="_blank" rel="noopener noreferrer" class="funshow-splash-footer-link funshow-splash-github-link">\n                            <span>View on GitHub</span>\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>\n                            </svg>\n                        </a>\n                    </div>\n                    <p>\n                        This software is released under the MIT License.<br>\n                        <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer" style="color: #ffffff;">https://opensource.org/licenses/MIT</a>\n                    </p>\n                </div>\n            </div>\n        `}bindEvents(){this.optionClickHandler=this.optionClickHandler.bind(this);const options=this.container.querySelectorAll(".funshow-splash-option, .funshow-splash-help-option");options.forEach((option=>{option.addEventListener("click",this.optionClickHandler)}))}optionClickHandler(event){const option=event.currentTarget.dataset.option;this.emit("optionSelected",option)}}class FunShowHelp extends FunShowEventEmitter{constructor(container){super();this.container=container;this.givenContainer=this.container;if(!this.container){this.container=document.createElement("div");document.body.appendChild(this.container)}this.originalBodyOverflow=document.body.style.overflow;this.setBodyOverflow();this.injectCSS();this.injectHTML();this.bindEvents();this.setHelpContent(this.getDefaultHelpContent())}destroy(){this.emit("destroy");const styleElement=document.head.querySelector("style[data-funshow-help-style]");if(styleElement){document.head.removeChild(styleElement)}this.container.innerHTML="";this.off();if(this.container!=this.givenContainer){this.container.remove()}this.givenContainer=null;this.container=null;this.resetBodyOverflow()}setBodyOverflow(){document.body.style.overflow="auto"}resetBodyOverflow(){document.body.style.overflow=this.originalBodyOverflow}injectCSS(){const style=document.createElement("style");style.setAttribute("data-funshow-help-style","");const styles=`\n            .funshow-help-wrapper {\n                font-family: Arial, sans-serif;\n                background-color: #121212;\n                color: #ffffff;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: flex-start;\n                min-height: 100vh;\n                margin: 0;\n                padding: 0;\n                box-sizing: border-box;\n                width: 100%;\n                gap: 0;\n            }\n\n            .funshow-help-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                background-color: #1e1e1e;\n                position: sticky;\n                padding: 8px;\n                top: 0;\n                z-index: 1000;\n                width: 100%;\n                box-sizing: border-box;\n            }\n\n            .funshow-help-back-button {\n                background: none;\n                border: none;\n                color: #ffffff;\n                font-size: 1rem;\n                cursor: pointer;\n                padding: 0.5rem 1rem;\n                transition: background-color 0.3s ease;\n            }\n\n            .funshow-help-back-button:hover {\n                background-color: rgba(255, 255, 255, 0.1);\n            }\n\n            .funshow-help-header-title {\n                font-size: 1.5rem;\n                font-weight: bold;\n                position: absolute;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n\n            .funshow-help-body {\n                flex-grow: 1;\n                padding: 2rem;\n            }\n\n            .funshow-help-content-container {\n                max-width: 800px;\n                margin: 0 auto;\n            }\n\n            .funshow-help-content-item {\n                margin-bottom: 2rem;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n                padding-bottom: 1rem;\n            }\n\n            .funshow-help-content-item:last-child {\n                border-bottom: none;\n            }\n\n            .funshow-help-content-title {\n                font-size: 1.2rem;\n                font-weight: bold;\n                margin-bottom: 0.5rem;\n                color: #4a90e2;\n            }\n\n            .funshow-help-content-body {\n                font-size: 1rem;\n                line-height: 1.6;\n            }\n\n            .funshow-help-footer {\n                font-size: 0.8rem;\n                text-align: center;\n                opacity: 0.7;\n                margin-top: 2rem;\n                padding-bottom: 2rem;\n                width: 100%;\n            }\n\n            .funshow-help-footer-links {\n                display: flex;\n                justify-content: center;\n                gap: 20px;\n                margin-bottom: 15px;\n            }\n\n            .funshow-help-footer-link {\n                display: inline-flex;\n                align-items: center;\n                color: #ffffff;\n                text-decoration: none;\n                transition: color 0.3s ease;\n            }\n\n            .funshow-help-footer-link:hover {\n                color: #4a90e2;\n            }\n\n            .funshow-help-footer-link svg {\n                width: 16px;\n                height: 16px;\n                margin-left: 5px;\n            }\n\n            .funshow-help-footer-link span {\n                font-weight: bold;\n            }\n\n            .funshow-help-title {\n                margin: 0;\n            }\n\n            .emphasis {\n                background-color: #333;\n                letter-spacing: 0.1em;\n                font-size: 0.9em;\n                padding: 2px;\n                padding-left: 4px;\n                padding-right: 4px;\n                border-radius: 4px;\n            }\n        `;style.textContent=styles;document.head.appendChild(style)}injectHTML(){this.container.innerHTML=`\n            <div class="funshow-help-wrapper">\n                <header class="funshow-help-header">\n                    <button class="funshow-help-back-button" style="margin: 0 10px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; background-color: #6c757d; color: #ffffff; display: flex; align-items: center; justify-content: center; gap: 8px;">\n                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="height: 20px;">\n                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="currentColor"/>\n                        </svg>\n                        <div>Back</div>\n                    </button>\n                    <h1 class="funshow-help-title">FunShow Help</h1>\n                    <div style="width: 70px;"></div>\n                </header>\n\n                <main class="funshow-help-body">\n                    \x3c!-- Help content goes here --\x3e\n                </main>\n\n                <footer class="funshow-help-footer">\n                    <div class="funshow-help-footer-links">\n                        <a href="https://x.com/anarchyarcade" target="_blank" rel="noopener noreferrer" class="funshow-help-footer-link funshow-help-x-link">\n                            <span>Created by SM Sith Lord</span>\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>\n                            </svg>\n                        </a>\n                        <a href="https://github.com/smsithlord/funshow" target="_blank" rel="noopener noreferrer" class="funshow-help-footer-link funshow-help-github-link">\n                            <span>View on GitHub</span>\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>\n                            </svg>\n                        </a>\n                    </div>\n                    <p>\n                        This software is released under the MIT License.<br>\n                        <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer" style="color: #ffffff;">https://opensource.org/licenses/MIT</a>\n                    </p>\n                </footer>\n            </div>\n        `}bindEvents(){this.backButtonClickHandler=this.backButtonClickHandler.bind(this);const backButton=this.container.querySelector(".funshow-help-back-button");backButton.addEventListener("click",this.backButtonClickHandler)}backButtonClickHandler(){this.destroy();window.funShowEnvironment.newGame()}setHelpContent(content){const bodyElement=this.container.querySelector(".funshow-help-body");bodyElement.innerHTML=content}setHelpContent(helpItems){const bodyElement=this.container.querySelector(".funshow-help-body");const helpHtml=helpItems.map((item=>`\n            <div class="funshow-help-content-item">\n                <div class="funshow-help-content-title">${item.title}</div>\n                <div class="funshow-help-content-body">${item.content}</div>\n            </div>\n        `)).join("");bodyElement.innerHTML=`\n            <div class="funshow-help-content-container">\n                ${helpHtml}\n            </div>\n        `}getDefaultHelpContent(){return[{title:"What is FunShow?",content:`\n                    <p>FunShow is an tool for creating and viewing interactive slideshows of text, images, & videos.</p>\n                    <p>It can run in <span class="emphasis">LOCAL MODE</span> from the local file system, or <span class="emphasis">SERVER MODE</span> from your own website.</p>\n                    <p><span class="emphasis">LOCAL MODE</span> can also be used <b>OFFLINE</b> (with the exception of Google Fonts not working.)</p>\n                `},{title:"Who is FunShow for?",content:`\n                    <p><span class="emphasis">INDIVIDUALS</span> can use it in <span class="emphasis">LOCAL MODE</span> as a fun way to view their media.</p>\n                    <p><span class="emphasis">DEVELOPERS</span> can host it in <span class="emphasis">SERVER MODE</span> on their own website as a tool for their users, <b>or</b> they can save out slideshows & host only the <span class="emphasis">VIEWER</span> as a media gallery viewer.</p>\n                `},{title:"Creating a New Show",content:`\n                    <p>To create a new show, click on the <span class="emphasis">BUILDER</span> option from the main menu. The <span class="emphasis">BUILDER</span> is where you can add media elements, arrange them in sequence, and set transitions between them.</p>\n                `},{title:"Using Your Own Media",content:`\n                    <p>Images, video, & text/HTML slides are supported. You can drag & drop your media to add it.</p>\n                    <p><span class="emphasis">LOCAL MODE</span> requires you set the <span class="emphasis">WORKING DIRECTORY</span> <b>if</b> you want to be able to save/load local slideshows.</p>\n                    <p><span class="emphasis">DEVELOPERS</span> that are planning to deploy in <span class="emphasis">SERVER MODE</span> can make use of the <span class="emphasis">CONTENT PATH</span> to define the relative (or absolute) path to load media on their server. <span class="emphasis">CLOUDINARY</span> URLs are supported w/ an option to automatically apply transforms.</p>\n                `},{title:"Sharing Your Show",content:`\n                    <p>To save, load, or share a slideshow, you'll want to set the <span class="emphasis">WORKING DIRECTORY</span> and/or the <span class="emphasis">CONTENT DIRECTORY</span> so that the slideshow knows where to find the media the next it is loaded.</p>\n                    <p>The <span class="emphasis">WORKING DIRECTORY</span> is used when the slideshow is loaded into the <span class="emphasis">BUILDER</span>.</p>\n                    <p>The <span class="emphasis">CONTENT DIRECTORY</span> is used when a <span class="emphasis">DEVELOPER</span> deploys the slideshow onto their own website & load the slideshow in the <span class="emphasis">VIEWER</span>.</p>\n                    <p><span class="emphasis">INDIVIDUALS</span> using <span class="emphasis">LOCAL MODE</span> cannot share their slideshows because they are referencing local media. But they can load them locally into the <span class="emphasis">BUILDER</span> and play them from there.</p>\n                `}]}}class FunShowFilePacker extends FunShowEventEmitter{constructor(){super();this.files=[];this.zipName="";this.zipPackage=null;this.manifests={slideshowFolder:{name:"Slideshow Folder & Developer Build Manifest",description:"A built package for end-users to use from their local file system.",files:[{file:"funshow",files:[{file:"index.html"},{file:"dist",files:[{file:"funshow-shared.min.js"},{file:"funshow-viewer.min.js"},{file:"funshow-builder.min.js"}]}]}]},developerBuild:{name:"Slideshow Folder & Developer Build Manifest",description:"A built package for end-users to use from their local file system.",files:[{file:"funshow",files:[{file:"index.html"},{file:"dist",files:[{file:"funshow-shared.min.js"},{file:"funshow-viewer.min.js"},{file:"funshow-builder.min.js"},{file:"thirdparty",files:[{file:"jszip.min.js"},{file:"bundle.min.js"},{file:"LICENSE.txt"}]}]}]}]}}}async packFilesFromManifest({manifestId:manifestId,startInPath:startInPath=""}){const manifest=this.manifests[manifestId];if(!manifest){throw new Error(`Manifest with id "${manifestId}" not found.`)}this.zipName=`${manifest.name}.zip`;const normalizedStartInPath=this.normalizePath(startInPath);const fileArray=await this.processManifestFiles(manifest.files,normalizedStartInPath);return this.packFiles(this.zipName,fileArray)}async packFilesAndDownloadFromManifest({manifestId:manifestId,startInPath:startInPath=""}){await this.packFilesFromManifest({manifestId:manifestId,startInPath:startInPath});this.downloadPackage()}async processManifestFiles(files,basePath=""){let fileArray=[];for(const entry of files){const currentPath=basePath?`${basePath}${entry.file}`:entry.file;if(entry.files){fileArray=fileArray.concat(await this.processManifestFiles(entry.files,`${currentPath}/`))}else{fileArray.push(currentPath)}}return fileArray}normalizePath(path){let normalized=path.replace(/\\/g,"/");if(normalized&&!normalized.endsWith("/")){normalized+="/"}return normalized}async fetchFile(fileUrl){try{const response=await fetch(fileUrl);if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}const content=await response.text();return{name:this.getFileName(fileUrl),content:content}}catch(error){console.error(`Error fetching ${fileUrl}: ${error.message}`);return{name:this.getFileName(fileUrl),content:`Error: ${error.message}`}}}getFileName(fileUrl){const parts=fileUrl.split("/");return parts[parts.length-1]||"file.txt"}async packFiles(zipName,fileArray){this.zipName=zipName;const fetchPromises=fileArray.map((entry=>this.processEntry(entry)));this.files=await Promise.all(fetchPromises);this.zipPackage=await this.zipFiles();return this.zipPackage}async processEntry(entry){if(typeof entry==="string"){return this.fetchFile(entry)}else if(typeof entry==="object"){if("filename"in entry&&"data"in entry){return{name:entry.filename,content:typeof entry.data==="string"?entry.data:JSON.stringify(entry.data)}}else{return{name:"object.json",content:JSON.stringify(entry)}}}}async zipFiles(){const zip=new JSZip;this.files.forEach((file=>{zip.file(file.name,file.content)}));try{const content=await zip.generateAsync({type:"blob"});return{name:this.zipName,data:content}}catch(error){console.error("Error generating zip file:",error);throw error}}downloadPackage(){if(!this.zipPackage){console.error("No zip package available. Please pack files first.");return}const url=URL.createObjectURL(this.zipPackage.data);const a=document.createElement("a");a.href=url;a.download=this.zipPackage.name;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url)}async packFilesAndDownload(zipName,fileArray){await this.packFiles(zipName,fileArray);this.downloadPackage()}}class FunShowBuilder extends FunShowEventEmitter{constructor(container,slideshow=null){super();this.container=container;this.givenContainer=this.container;if(!this.container){this.container=document.createElement("div");document.body.appendChild(this.container)}this.schema=window.funShowEnvironment.schema;this.loadedFileName=null;this.lastUsedPath="";this.initialStateHash=null;this.currentZoom=1;this.injectCSS();this.injectHTML();this.bindEvents();if(slideshow){this.loadSlideshow(slideshow)}else{this.loadDefaultSlideshow()}this.setInitialStateHash();this.addBeforeUnloadListener()}destroy(){this.emit("destroy");this.container.removeEventListener("mouseover",this.containerMouseOverHandler);this.container.removeEventListener("mouseout",this.containerMouseOutHandler);document.getElementById("exitButton").removeEventListener("click",this.exitButtonClickHandler);document.getElementById("previewButton").removeEventListener("click",this.previewButtonClickHandler);document.getElementById("newButton").removeEventListener("click",this.newButtonClickHandler);document.getElementById("saveButton").removeEventListener("click",this.saveButtonClickHandler);document.getElementById("loadButton").removeEventListener("click",this.loadButtonClickHandler);this.zoomElem.removeEventListener("click",this.zoomChangeHandler);this.zoomElem=null;const slides=document.querySelectorAll(".funshow-builder-slide");slides.forEach((slide=>{slide.removeEventListener("mousedown",this.slideMouseDown);slide.removeEventListener("dragstart",this.dragStart);slide.removeEventListener("dragenter",this.dragEnter);slide.removeEventListener("dragover",this.dragOver);slide.removeEventListener("dragleave",this.dragLeave);slide.removeEventListener("drop",this.drop);slide.removeEventListener("dragend",this.dragEnd);const editIcon=slide.querySelector(".funshow-builder-slide-edit-icon");editIcon.removeEventListener("click",this.toggleSlideEdit);const deleteIcon=slide.querySelector(".funshow-builder-slide-delete-icon");deleteIcon.removeEventListener("click",this.toggleSlideDeleteConfirmation);const deleteConfirmYes=slide.querySelector(".funshow-builder-delete-confirm-yes");deleteConfirmYes.removeEventListener("click",this.deleteSlide);const deleteConfirmCancel=slide.querySelector(".funshow-builder-delete-confirm-cancel");deleteConfirmCancel.removeEventListener("click",this.toggleSlideDeleteConfirmation)}));const styleElement=document.head.querySelector("style[data-funshow-builder-style]");if(styleElement){document.head.removeChild(styleElement)}this.container.innerHTML="";const modalElements=document.querySelectorAll(".funshow-builder-modal, .funshow-builder-load-modal");modalElements.forEach((element=>element.remove()));this.off();if(this.container!=this.givenContainer){this.container.remove()}this.givenContainer=null;this.container=null;this.schema=null;this.loadedFileName=null;this.lastUsedPath=null}setInitialStateHash(){const currentState=this.getSlideshowState();this.initialStateHash=this.hashString(JSON.stringify(currentState))}addBeforeUnloadListener(){window.addEventListener("beforeunload",(event=>{if(this.hasUnsavedChanges()){event.preventDefault();event.returnValue="You have unsaved changes. Are you sure you want to leave?"}}))}hasUnsavedChanges(){const currentState=this.getSlideshowState();const currentStateHash=this.hashString(JSON.stringify(currentState));return currentStateHash!==this.initialStateHash}getSlideshowState(){const slideshowConfig=this.getSlideshowConfig();const slides=this.getSlides().map((slideElement=>slideElement.slide));return{config:slideshowConfig,slides:slides}}hashString(str){let hash=0;for(let i=0;i<str.length;i++){const char=str.charCodeAt(i);hash=(hash<<5)-hash+char;hash=hash&hash}return hash}injectCSS(){const style=document.createElement("style");style.setAttribute("data-funshow-builder-style","");const darkMode=true;const commonStyles=`\n            .funshow-builder-container {\n                font-family: 'Arial', sans-serif;\n                display: flex;\n                height: 100vh;\n                overflow: hidden;\n            }\n            .funshow-builder-column-right, .funshow-builder-column-left-content {\n                overflow-y: auto;\n            }\n            .funshow-builder-column-left {\n                display: flex;\n                flex-direction: column;\n\n                width: 320px;\n                min-width: 320px;\n            }\n\n            .funshow-builder-column-left-content {\n                display: flex;\n                flex-direction: column;\n            }\n            .funshow-builder-footer {\n                margin-top: auto;\n                padding: 10px;\n                display: flex;\n                justify-content: space-between;\n            }\n            .funshow-builder-footer-button {\n                padding: 8px 16px;\n                border: none;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 14px;\n                transition: background-color 0.3s;\n            }\n            .funshow-builder-column-right {\n                flex-grow: 1;\n                min-width: 225px;\n            }\n            .funshow-builder-header {\n                display: flex;\n                flex-direction: column;\n                padding: 12px;\n            }\n            .funshow-builder-header-top {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n            .funshow-builder-header h2, .funshow-builder-header h3 {\n                margin: 0;\n            }\n            .funshow-builder-header-content {\n                display: flex;\n                flex-direction: column;\n                align-items: flex-start;\n            }\n\n            .funshow-builder-header-title {\n                display: flex;\n                flex-direction: rows;\n                align-items: center;\n            }\n\n            .funshow-builder-header-title svg {\n                width: 48px;\n                height: 48px;\n            }\n\n            .funshow-builder-zoom-container {\n                display: flex;\n                align-items: center;\n            }\n            .funshow-builder-zoom-slider {\n                width: 100px;\n                margin-left: 10px;\n            }\n\n            .funshow-builder-file-name {\n                font-size: 14px;\n                margin-top: 5px;\n            }\n            .funshow-builder-buttons {\n                display: flex;\n                align-items: center;\n            }\n            .funshow-builder-button {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                width: 32px;\n                height: 32px;\n                padding: 0;\n                margin: 0 5px;\n                background-color: transparent;\n                border: none;\n                cursor: pointer;\n            }\n            .funshow-builder-button:hover {\n                border-radius: 4px;\n            }\n            .funshow-builder-button svg {\n                width: 20px;\n                height: 20px;\n            }\n            .funshow-builder-form-group {\n                display: flex;\n                align-items: center;\n                margin-bottom: 5px;\n                padding: 5px 10px;\n                border-radius: 4px;\n                transition: background-color 0.3s;\n            }\n            .funshow-builder-form-group label {\n                flex: 0 0 90px;\n                margin-right: 10px;\n                font-weight: bold;\n                font-size: 0.8em;\n            }\n            .funshow-builder-form-group input[type="text"],\n            .funshow-builder-form-group input[type="number"],\n            .funshow-builder-form-group select,\n            .funshow-builder-form-group textarea {\n                flex: 1;\n                padding: 3px 5px;\n                border-radius: 4px;\n                box-sizing: border-box;\n                font-size: 0.9em;\n            }\n            .funshow-builder-form-group input[type="checkbox"] {\n                margin-right: 5px;\n            }\n            .funshow-builder-form-group input[type="range"] {\n                flex: 1;\n                margin-right: 10px;\n            }\n            .funshow-builder-range-value {\n                flex: 0 0 40px;\n                text-align: right;\n                font-size: 0.9em;\n            }\n            .funshow-builder-slides {\n                display: flex;\n                flex-wrap: wrap;\n                padding: 10px;\n            }\n            .funshow-builder-slides-empty .funshow-builder-hide-if-noslides {\n                display: none;\n            }\n            .funshow-builder-slide {\n                width: 280px;\n                height: 280px;\n                margin: 10px;\n                padding: 15px;\n                border-radius: 4px;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                overflow-y: auto;\n                position: relative;\n            }\n            .funshow-builder-slide-info {\n                position: absolute;\n                top: 5px;\n                left: 5px;\n                display: flex;\n                align-items: center;\n            }\n            .funshow-builder-slide-info-actions {\n                display: flex;\n                align-items: center;\n            }\n            .funshow-builder-slide:not(:hover) .funshow-builder-slide-info-actions {\n                display: none;\n            }\n            .funshow-builder-slide-number {\n                padding: 2px 6px;\n                border-radius: 3px;\n                font-size: 0.8em;\n                margin-right: 5px;\n            }\n            .funshow-builder-slide-edit-icon, .funshow-builder-slide-delete-icon {\n                cursor: pointer;\n            }\n            .funshow-builder-slide-delete-icon {\n                margin-left: 4px;\n            }\n            .funshow-builder-slide-preview {\n                display: flex;\n                flex-direction: column;\n                text-align: center;\n                justify-content: center;\n                align-items: center;\n                height: 100%;\n                font-size: 24px;\n                font-weight: bold;\n                background-size: cover;\n                background-repeat: no-repeat;\n                background-position: center center;\n            }\n            .funshow-builder-slide-edit-content {\n                display: none;\n            }\n            .funshow-builder-slide.funshow-builder-edit .funshow-builder-slide-preview {\n                display: none;\n            }\n            .funshow-builder-slide.funshow-builder-edit .funshow-builder-slide-edit-content {\n                display: block;\n            }\n            .funshow-builder-add-slide {\n                width: 310px;\n                height: 310px;\n                margin: 10px;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 24px;\n            }\n            .funshow-builder-help-flyout {\n                position: fixed;\n                bottom: 0;\n                left: 50%;\n                transform: translateX(-50%);\n                padding: 10px 20px;\n                border-radius: 4px 4px 0 0;\n                font-size: 14px;\n                opacity: 0;\n                transition: opacity 0.3s;\n                pointer-events: none;\n            }\n            .funshow-builder-scrollable::-webkit-scrollbar {\n                width: 8px;\n            }\n            .funshow-builder-scrollable::-webkit-scrollbar-thumb {\n                border-radius: 4px;\n            }\n            .funshow-builder-scrollable::-webkit-scrollbar-track {\n                border-radius: 4px;\n            }\n            .funshow-builder-slide-range {\n                width: 6px;\n            }\n            .funshow-builder-slide input[type="text"],\n            .funshow-builder-slide input[type="number"],\n            .funshow-builder-slide select,\n            .funshow-builder-slide textarea {\n                width: 100%;\n                max-width: 220px;\n                box-sizing: border-box;\n            }\n            .funshow-builder-slide textarea {\n                resize: vertical;\n                min-height: 60px;\n            }\n            .funshow-builder-slide-delete-confirmation {\n                display: none;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                z-index: 10;\n            }\n            .funshow-builder-slide.funshow-builder-delete-confirm .funshow-builder-slide-delete-confirmation {\n                display: flex;\n            }\n            .funshow-builder-slide.funshow-builder-delete-confirm .funshow-builder-slide-preview,\n            .funshow-builder-slide.funshow-builder-delete-confirm .funshow-builder-slide-edit-content {\n                display: none;\n            }\n            .funshow-builder-delete-confirm-buttons {\n                margin-top: 10px;\n            }\n            .funshow-builder-delete-confirm-button {\n                margin: 0 5px;\n                padding: 5px 10px;\n                border: none;\n                border-radius: 3px;\n                cursor: pointer;\n            }\n            .funshow-builder-load-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                z-index: 1000;\n            }\n            .funshow-builder-load-content {\n                padding: 20px;\n                border-radius: 5px;\n                text-align: center;\n            }\n            .funshow-builder-load-dropzone {\n                border-radius: 5px;\n                padding: 50px;\n                margin-bottom: 20px;\n                font-size: 18px;\n            }\n            .funshow-builder-load-browse,\n            .funshow-builder-load-cancel {\n                padding: 10px 20px;\n                border: none;\n                border-radius: 5px;\n                cursor: pointer;\n                font-size: 16px;\n                margin: 0 10px;\n            }\n            #funshow-builder-file-input {\n                display: none;\n            }\n            .funshow-builder-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                z-index: 1000;\n            }\n            .funshow-builder-modal-content {\n                padding: 20px;\n                border-radius: 5px;\n                text-align: center;\n            }\n            .funshow-builder-modal-buttons {\n                margin-top: 20px;\n            }\n            .funshow-builder-modal-button {\n                margin: 0 10px;\n                padding: 10px 20px;\n                border: none;\n                border-radius: 5px;\n                cursor: pointer;\n                font-size: 16px;\n            }\n            .funshow-builder-button-content {\n                display: flex;\n                flex-direction: rows;\n            }\n            .funshow-builder-button-content svg {\n                width: 16px;\n                height: 16px;\n                margin-right: 8px;\n            }\n            .funshow-builder-download-options {\n                display: flex;\n                justify-content: space-around;\n                margin-bottom: 20px;\n                gap: 8px;\n            }\n\n            .funshow-builder-download-option {\n                text-align: center;\n                cursor: pointer;\n                padding: 15px;\n                border: 1px solid #ccc;\n                border-radius: 8px;\n                transition: background-color 0.3s ease;\n                width: 100px;\n                height: 160px;\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n                align-items: center;\n                background-color: #f8f8f8;\n            }\n\n            .funshow-builder-download-option:hover {\n                background-color: #e8e8e8;\n            }\n\n            .funshow-builder-download-option svg {\n                margin-bottom: 10px;\n                fill: #333;\n            }\n\n            .funshow-builder-download-option p {\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0 0 5px 0;\n                color: #333;\n            }\n\n            .funshow-builder-download-option small {\n                font-size: 12px;\n                color: #666;\n            }\n\n            /* Update the error text color */\n            .funshow-builder-modal-content pre {\n                background-color: #f0f0f0;\n                padding: 10px;\n                border-radius: 5px;\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                color: #333; /* Darker color for better readability */\n            }\n\n            .funshow-builder-version-select {\n                margin-bottom: 20px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .funshow-builder-version-select select, {\n                margin-right: 10px;\n                padding: 5px;\n                border-radius: 5px;\n                border: 1px solid #ccc;\n            }\n\n            .funshow-builder-version-select label {\n                display: flex;\n                align-items: center;\n            }\n\n            .funshow-builder-version-select input[type="checkbox"] {\n                margin-right: 5px;\n            }\n\n            .funshow-builder-spinner {\n                border: 4px solid #f3f3f3;\n                border-top: 4px solid #3498db;\n                border-radius: 50%;\n                width: 40px;\n                height: 40px;\n                animation: spin 1s linear infinite;\n                margin: 20px auto;\n            }\n\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n\n            .funshow-builder-modal-content pre {\n                background-color: #f0f0f0;\n                padding: 10px;\n                border-radius: 5px;\n                white-space: pre-wrap;\n                word-wrap: break-word;\n            }\n\n            .funshow-env-local .funshow-env-hide-if-local {\n                display: none;\n            }\n\n            .funshow-checkmark-appear {\n                margin: 24px;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                text-align: center;\n                height: 100%;\n                opacity: 0;\n                transition: opacity 0.5s ease-in-out;\n            }\n\n            .funshow-checkmark {\n                width: 56px;\n                height: 56px;\n                border-radius: 50%;\n                display: block;\n                stroke-width: 2;\n                stroke: #fff;\n                stroke-miterlimit: 10;\n                box-shadow: inset 0px 0px 0px #7ac142;\n                animation: funshow-fill .4s ease-in-out .4s forwards, funshow-scale .3s ease-in-out .9s both;\n            }\n\n            .funshow-checkmark__circle {\n                stroke-dasharray: 166;\n                stroke-dashoffset: 166;\n                stroke-width: 2;\n                stroke-miterlimit: 10;\n                stroke: #7ac142;\n                fill: none;\n                animation: funshow-stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;\n            }\n\n            .funshow-checkmark__check {\n                transform-origin: 50% 50%;\n                stroke-dasharray: 48;\n                stroke-dashoffset: 48;\n                animation: funshow-stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;\n            }\n\n            .funshow-builder-exit-preview {\n                position: absolute;\n                top: 20px;\n                left: 20px;\n                color: #999;\n                border-radius: 5px;\n                font-family: Arial, sans-serif;\n                font-size: 10px;\n                z-index: 9999;\n                display: flex;\n                flex-direction: rows;\n                align-items: center;\n                opacity: 0.7;\n                transition: opacity 1s ease;\n            }\n            .funshow-builder-exit-preview:hover {\n                opacity: 1.0;\n            }\n\n            @keyframes funshow-stroke {\n                100% {\n                    stroke-dashoffset: 0;\n                }\n            }\n\n            @keyframes funshow-scale {\n                0%, 100% {\n                    transform: none;\n                }\n                50% {\n                    transform: scale3d(1.1, 1.1, 1);\n                }\n            }\n\n            @keyframes funshow-fill {\n                100% {\n                    box-shadow: inset 0px 0px 0px 30px #7ac142;\n                }\n            }\n        `;const darkModeStyles=`\n            .funshow-builder-container { background-color: #1e1e1e; color: #e0e0e0; }\n            .funshow-builder-column-left { background-color: #252526; border-right: 1px solid #3e3e42; }\n            .funshow-builder-column-right { background-color: #1e1e1e; }\n            .funshow-builder-header { background-color: #2d2d30; }\n            .funshow-builder-file-name { color: #a0a0a0; }\n            .funshow-builder-button { color: #e0e0e0; }\n            .funshow-builder-button:hover { background-color: rgba(255, 255, 255, 0.1); }\n            .funshow-builder-form-group:hover { background-color: #3e3e42; }\n            .funshow-builder-form-group label { color: #e0e0e0; }\n            .funshow-builder-form-group input[type="text"],\n            .funshow-builder-form-group input[type="number"],\n            .funshow-builder-form-group select,\n            .funshow-builder-form-group textarea { \n                border: 1px solid #3e3e42; \n                background-color: #2d2d30; \n                color: #e0e0e0; \n            }\n            .funshow-builder-form-group input[type="range"] { background-color: #2d2d30; }\n            .funshow-builder-range-value { color: #e0e0e0; }\n            .funshow-builder-slide { \n                background-color: #2d2d30; \n                border: 1px solid #3e3e42; \n                box-shadow: 0 2px 4px rgba(0,0,0,0.2); \n            }\n            .funshow-builder-slide-number { background-color: rgba(255,255,255,0.1); color: #e0e0e0; }\n            .funshow-builder-slide-edit-icon, .funshow-builder-slide-delete-icon { \n                color: #e0e0e0; \n                fill: #e0e0e0; \n            }\n            .funshow-builder-slide-preview { color: #e0e0e0; }\n            .funshow-builder-add-slide { \n                background-color: #252526; \n                border: 2px dashed #3e3e42; \n                color: #a0a0a0; \n            }\n            .funshow-builder-help-flyout { \n                background-color: #2d2d30; \n                color: #e0e0e0; \n            }\n            .funshow-builder-scrollable::-webkit-scrollbar-thumb { background-color: #3e3e42; }\n            .funshow-builder-scrollable::-webkit-scrollbar-thumb:hover { background-color: #4e4e52; }\n            .funshow-builder-scrollable::-webkit-scrollbar-track { background-color: #252526; }\n            .funshow-builder-slide-delete-confirmation { \n                background-color: rgba(45, 45, 48, 0.9); \n                color: #e0e0e0; \n            }\n            .funshow-builder-delete-confirm-yes { background-color: #d9534f; color: white; }\n            .funshow-builder-delete-confirm-cancel { background-color: #5bc0de; color: white; }\n            .funshow-builder-load-modal { background-color: rgba(0, 0, 0, 0.8); }\n            .funshow-builder-load-content { \n                background-color: #2d2d30; \n                color: #e0e0e0; \n            }\n            .funshow-builder-load-dropzone { \n                border: 2px dashed #3e3e42; \n                color: #e0e0e0; \n            }\n            .funshow-builder-load-dropzone.dragover { background-color: #3e3e42; }\n            .funshow-builder-load-browse { background-color: #0e639c; color: white; }\n            .funshow-builder-load-cancel { background-color: #6c757d; color: white; }\n            .funshow-builder-modal { background-color: rgba(0, 0, 0, 0.8); }\n            .funshow-builder-modal-content { \n                background-color: #2d2d30; \n                color: #e0e0e0; \n            }\n            .funshow-builder-modal-button-primary { background-color: #0e639c; color: #ffffff; }\n            .funshow-builder-modal-button-secondary { background-color: #6c757d; color: #ffffff; }\n\n            .funshow-builder-footer { background-color: #252526; border-top: 1px solid #3e3e42; }\n            .funshow-builder-footer-button { background-color: #3e3e42; color: #e0e0e0; }\n            .funshow-builder-footer-button:hover { background-color: #4e4e52; }\n        `;const lightModeStyles=`\n            .funshow-builder-container { background-color: #ffffff; color: #000000; }\n            .funshow-builder-column-left { background-color: #f0f0f0; border-right: 1px solid #ccc; }\n            .funshow-builder-column-right { background-color: #fff; }\n            .funshow-builder-file-name { color: #666; }\n            .funshow-builder-button:hover { background-color: rgba(0, 0, 0, 0.1); }\n            .funshow-builder-form-group:hover { background-color: #e0e0e0; }\n            .funshow-builder-form-group input[type="text"],\n            .funshow-builder-form-group input[type="number"],\n            .funshow-builder-form-group select,\n            .funshow-builder-form-group textarea { \n                border: 1px solid #ccc; \n                background-color: #ffffff; \n                color: #000000; \n            }\n            .funshow-builder-slide { \n                background-color: #f9f9f9; \n                border: 1px solid #ddd; \n            }\n            .funshow-builder-slide-number { background-color: rgba(0,0,0,0.5); color: white; }\n            .funshow-builder-slide-edit-icon, .funshow-builder-slide-delete-icon { color: #000000; fill: #000000; }\n            .funshow-builder-add-slide { \n                background-color: #e0e0e0; \n                border: 2px dashed #aaa; \n                color: #666; \n            }\n            .funshow-builder-help-flyout { \n                background-color: #333; \n                color: #fff; \n            }\n            .funshow-builder-scrollable::-webkit-scrollbar-thumb { background-color: #888; }\n            .funshow-builder-scrollable::-webkit-scrollbar-thumb:hover { background-color: #666; }\n            .funshow-builder-scrollable::-webkit-scrollbar-track { background-color: #f0f0f0; }\n            .funshow-builder-slide-delete-confirmation { \n                background-color: rgba(255, 255, 255, 0.9); \n                color: #000000; \n            }\n            .funshow-builder-delete-confirm-yes { background-color: #d9534f; color: white; }\n            .funshow-builder-delete-confirm-cancel { background-color: #5bc0de; color: white; }\n            .funshow-builder-load-modal { background-color: rgba(0, 0, 0, 0.8); }\n            .funshow-builder-load-content { \n                background-color: white; \n                color: #000000; \n            }\n            .funshow-builder-load-dropzone { \n                border: 2px dashed #ccc; \n                color: #000000; \n            }\n            .funshow-builder-load-dropzone.dragover { background-color: #f0f0f0; }\n            .funshow-builder-load-browse { background-color: #4CAF50; color: white; }\n            .funshow-builder-load-cancel { background-color: #f44336; color: white; }\n            .funshow-builder-modal { background-color: rgba(0, 0, 0, 0.8); }\n            .funshow-builder-modal-content { \n                background-color: white; \n                color: #000000; \n            }\n            .funshow-builder-modal-button-primary { background-color: #4CAF50; color: white; }\n            .funshow-builder-modal-button-secondary { background-color: #f44336; color: white; }\n            .funshow-builder-footer { background-color: #f0f0f0; border-top: 1px solid #ccc; }\n            .funshow-builder-footer-button { background-color: #e0e0e0; color: #000000; }\n            .funshow-builder-footer-button:hover { background-color: #d0d0d0; }\n        `;style.textContent=`${commonStyles}${darkMode?darkModeStyles:lightModeStyles}`;document.head.appendChild(style)}injectHTML(){this.container.innerHTML=`\n            <div class="funshow-builder-container">\n                <div class="funshow-builder-column funshow-builder-column-left">\n                    <div class="funshow-builder-header">\n                        <div class="funshow-builder-header-top">\n                            <div class="funshow-builder-header-title">\n                                <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">\n                                    <g fill="currentColor">\n                                        <rect x="22" y="22" width="20" height="20"/>\n                                        <path d="M26 26h12M26 32h12M26 38h12" stroke="currentColor" stroke-width="1" fill="none"/>\n                                        <path d="M26 26h12M26 32h12M26 38h12" stroke="#000000" stroke-width="1"/>\n                                        <path d="M46 22v20M50 26v12" stroke="currentColor" stroke-width="2" fill="none"/>\n                                        <circle cx="46" cy="22" r="2"/>\n                                        <circle cx="46" cy="42" r="2"/>\n                                        <circle cx="50" cy="26" r="2"/>\n                                        <circle cx="50" cy="38" r="2"/>\n                                    </g>\n                                </svg>\n                                <h2>Builder</h2>\n                            </div>\n                            <div class="funshow-builder-buttons">\n                                <button class="funshow-builder-button" id="newButton" title="New">\n                                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">\n                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                                        <polyline points="14 2 14 8 20 8"></polyline>\n                                        <line x1="12" y1="18" x2="12" y2="12"></line>\n                                        <line x1="9" y1="15" x2="15" y2="15"></line>\n                                    </svg>\n                                </button>\n                                <button class="funshow-builder-button" id="saveButton" title="Save">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                                        <polyline points="7 10 12 15 17 10"></polyline>\n                                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                                    </svg>\n                                </button>\n                                <button class="funshow-builder-button" id="loadButton" title="Open">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                                    </svg>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="funshow-builder-file-name" id="fileNameDisplay">Unsaved slideshow</div>\n                    </div>    \n                    <div class="funshow-builder-column-left-content funshow-builder-scrollable">\n                        <div id="slideshowConfig"></div>\n                    </div>\n                    <div class="funshow-builder-footer">\n                        <button id="exitButton" class="funshow-builder-footer-button">\n                            <div class="funshow-builder-button-content">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                    <rect x="8" y="3" width="10" height="18" rx="2" ry="2"></rect>\n                                    <path d="M14 12H3"></path>\n                                    <path d="M5 8l-4 4 4 4" stroke-width="2.5"></path>\n                                </svg>\n                                Exit\n                            </div>\n                        </button>\n                        <button id="previewButton" class="funshow-builder-footer-button">\n                            <div class="funshow-builder-button-content">\n                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                                    <path d="M8 21h8"></path>\n                                    <path d="M12 17v4"></path>\n                                    <polygon points="10 8.5 16 10.5 10 12.5 10 8.5" fill="currentColor"></polygon>\n                                </svg>\n                                Preview\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <div class="funshow-builder-column funshow-builder-column-right funshow-builder-scrollable">\n                    <div class="funshow-builder-header" style="margin-bottom: 0;">\n                        <div class="funshow-builder-header-top">\n                            <h3>Slides</h3>\n                            <div class="funshow-builder-zoom-container">\n                                <label for="zoom">\n                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">\n                                      <path d="M21 3H15M21 3V9M21 3L14 10"></path>\n                                      <path d="M3 21H9M3 21V15M3 21L10 14"></path>\n                                    </svg>\n                                </label>\n                                <input type="range" id="zoom" class="funshow-builder-zoom-slider" min="0.25" max="1" step="0.25" value="1">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="funshow-builder-slides" id="slidesContainer"></div>\n                </div>\n            </div>\n            <div class="funshow-builder-help-flyout" id="helpFlyout"></div>\n        `}applyBuilderZoomToSlideElement(slideElement){const zoom=this.zoomElem.value;slideElement.style.zoom=zoom}handleZoomChange(e){const slideElements=document.querySelectorAll("#slidesContainer .funshow-builder-slide, #slidesContainer .funshow-builder-add-slide");slideElements.forEach((slideElement=>{this.applyBuilderZoomToSlideElement(slideElement)}))}bindEvents(){this.containerMouseOverHandler=this.handleContainerMouseOver.bind(this);this.containerMouseOutHandler=this.handleContainerMouseOut.bind(this);this.newButtonClickHandler=this.showNewConfirmModal.bind(this);this.saveButtonClickHandler=this.saveSlideshow.bind(this);this.loadButtonClickHandler=this.showLoadModal.bind(this);this.zoomChangeHandler=this.handleZoomChange.bind(this);this.container.addEventListener("mouseover",this.containerMouseOverHandler);this.container.addEventListener("mouseout",this.containerMouseOutHandler);document.getElementById("newButton").addEventListener("click",this.newButtonClickHandler);document.getElementById("saveButton").addEventListener("click",this.saveButtonClickHandler);document.getElementById("loadButton").addEventListener("click",this.loadButtonClickHandler);this.zoomElem=document.getElementById("zoom");this.zoomElem.addEventListener("change",this.zoomChangeHandler);this.exitButtonClickHandler=this.handleExitButtonClick.bind(this);this.previewButtonClickHandler=this.handlePreviewButtonClick.bind(this);document.getElementById("exitButton").addEventListener("click",this.exitButtonClickHandler);document.getElementById("previewButton").addEventListener("click",this.previewButtonClickHandler)}handleExitButtonClick(){this.showExitConfirmModal()}handlePreviewButtonClick(){const slideElements=this.getSlides();if(slideElements.length===0){this.addNewSlide()}this.generateJSON(false).then((slideshow=>{slideshow.items=slideshow.slides;delete slideshow.slides;const funShow=new FunShow({slideshow:slideshow,allowWorkingPath:true});funShow.stage.startSlideshow();this.container.style.display="none";const exitPreviewModeButton=document.createElement("div");exitPreviewModeButton.className="funshow-builder-exit-preview";exitPreviewModeButton.innerHTML=`\n            <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary">\n                <div class="funshow-builder-button-content">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <rect x="8" y="3" width="10" height="18" rx="2" ry="2"></rect>\n                        <path d="M14 12H3"></path>\n                        <path d="M5 8l-4 4 4 4" stroke-width="2.5"></path>\n                    </svg>\n                    Stop Preview\n                </div>\n            </button>\n            `;exitPreviewModeButton.addEventListener("click",(()=>{funShow.destroy();this.container.style.display="block";exitPreviewModeButton.remove();delete document.body.originalBackground}));document.body.appendChild(exitPreviewModeButton)}))}handleContainerMouseOver(e){const formGroup=e.target.closest(".funshow-builder-form-group");if(formGroup){const helpText=formGroup.getAttribute("data-help");if(helpText){this.showHelpFlyout(helpText)}}}handleContainerMouseOut(e){if(!e.relatedTarget||!e.relatedTarget.closest(".funshow-builder-form-group")){this.hideHelpFlyout()}}showNewConfirmModal(){const modal=document.createElement("div");modal.className="funshow-builder-modal";modal.innerHTML=`\n            <div class="funshow-builder-modal-content">\n                <p>Discard all changes & create a new slideshow?</p>\n                <div class="funshow-builder-modal-buttons">\n                    <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="newConfirmYes">\n                        <div class="funshow-builder-button-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M20 6L9 17l-5-5"></path>\n                            </svg>\n                            Yes\n                        </div>\n                    </button>\n                    <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="newConfirmCancel">\n                        <div class="funshow-builder-button-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <path d="M15 9l-6 6"></path>\n                                <path d="M9 9l6 6"></path>\n                            </svg>\n                            Cancel\n                        </div>\n                    </button>\n                </div>\n            </div>\n        `;document.body.appendChild(modal);document.getElementById("newConfirmYes").addEventListener("click",(()=>{this.loadDefaultSlideshow();document.body.removeChild(modal)}));document.getElementById("newConfirmCancel").addEventListener("click",(()=>{document.body.removeChild(modal)}))}showExitConfirmModal(){const modal=document.createElement("div");modal.className="funshow-builder-modal";modal.innerHTML=`\n            <div class="funshow-builder-modal-content">\n                <p>Discard all changes & exit back to the splash screen?</p>\n                <div class="funshow-builder-modal-buttons">\n                    <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="exitConfirmYes">\n                        <div class="funshow-builder-button-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M20 6L9 17l-5-5"></path>\n                            </svg>\n                            Discard & Exit\n                        </div>\n                    </button>\n                    <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="exitConfirmCancel">\n                        <div class="funshow-builder-button-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <path d="M15 9l-6 6"></path>\n                                <path d="M9 9l6 6"></path>\n                            </svg>\n                            Cancel\n                        </div>\n                    </button>\n                </div>\n            </div>\n        `;document.body.appendChild(modal);document.getElementById("exitConfirmYes").addEventListener("click",(()=>{this.destroy();window.funShowEnvironment.newGame()}));document.getElementById("exitConfirmCancel").addEventListener("click",(()=>{document.body.removeChild(modal)}))}showLoadModal(){const modal=document.createElement("div");modal.className="funshow-builder-load-modal";modal.innerHTML=`\n            <div class="funshow-builder-load-content">\n                <div class="funshow-builder-load-dropzone" id="funshow-builder-dropzone">\n                    Drag & drop a save JSON file here\n                </div>\n                <button class="funshow-builder-load-browse" id="funshow-builder-browse">\n                    <div class="funshow-builder-button-content">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n                        </svg>\n                        Browse...\n                    </div>\n                </button>\n                <button class="funshow-builder-load-cancel" id="funshow-builder-cancel">\n                    <div class="funshow-builder-button-content">\n                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <circle cx="12" cy="12" r="10"></circle>\n                            <path d="M15 9l-6 6"></path>\n                            <path d="M9 9l6 6"></path>\n                        </svg>\n                        Cancel\n                    </div>\n                </button>\n                <input type="file" id="funshow-builder-file-input" accept=".json">\n            </div>\n        `;document.body.appendChild(modal);const dropzone=document.getElementById("funshow-builder-dropzone");const fileInput=document.getElementById("funshow-builder-file-input");const browseButton=document.getElementById("funshow-builder-browse");const cancelButton=document.getElementById("funshow-builder-cancel");dropzone.addEventListener("dragover",(e=>{e.preventDefault();dropzone.classList.add("dragover")}));dropzone.addEventListener("dragleave",(()=>{dropzone.classList.remove("dragover")}));dropzone.addEventListener("drop",(e=>{e.preventDefault();dropzone.classList.remove("dragover");const file=e.dataTransfer.files[0];this.loadFile(file)}));browseButton.addEventListener("click",(()=>{fileInput.click()}));fileInput.addEventListener("change",(e=>{const file=e.target.files[0];this.loadFile(file)}));cancelButton.addEventListener("click",(()=>{document.body.removeChild(modal)}))}updateLastUsedPath(config){let path=config.workingDirectory||config.contentPath||"";path=path.replace(/\\/g,"/");if(path&&!path.endsWith("/")){path+="/"}this.lastUsedPath=path}loadSlideshow(slideshow){try{if(typeof slideshow==="string"){slideshow=JSON.parse(slideshow)}const defaultSlideshow=window.funShowEnvironment.generateDefaultSlideshow();const mergedSlideshow=window.funShowEnvironment.mergeSlideshow(defaultSlideshow,slideshow);this.updateLastUsedPath(mergedSlideshow.config);this.renderSlideshowConfig(mergedSlideshow.config);this.renderSlides(mergedSlideshow.slides);this.loadedFileName="slideshow_data.json";document.getElementById("fileNameDisplay").textContent=`Filename: ${this.loadedFileName}`}catch(error){console.error("Error loading slideshow:",error);alert("Invalid slideshow data. Loading default slideshow.");this.loadDefaultSlideshow()}this.setInitialStateHash()}loadFile(file){const reader=new FileReader;reader.onload=e=>{try{const slideshowData=JSON.parse(e.target.result);this.loadSlideshow(slideshowData);this.loadedFileName=file.name;document.getElementById("fileNameDisplay").textContent=`Filename: ${this.loadedFileName}`;document.querySelector(".funshow-builder-load-modal").remove()}catch(error){console.error("Error parsing JSON file:",error);alert("Invalid JSON file. Please try again.")}};reader.readAsText(file)}saveSlideshow(){const modal=document.createElement("div");modal.className="funshow-builder-modal";modal.innerHTML=`\n            <div class="funshow-builder-modal-content">\n                <h2>Choose Download Type</h2>\n                <div class="funshow-builder-download-options">\n                    <div class="funshow-builder-download-option" data-type="json">\n                        <svg viewBox="0 0 24 24" width="48" height="48">\n                            <path d="M14 2H6C4.9 2 4 2.9 4 4v16c0 1.1 0.9 2 2 2h12c1.1 0 2-0.9 2-2V8l-6-6zM16 18H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>\n                        </svg>\n                        <p>JSON</p>\n                        <small>Download raw JSON data</small>\n                    </div>\n                    <div class="funshow-builder-download-option funshow-env-hide-if-local" data-type="user">\n                        <svg viewBox="0 0 24 24" width="48" height="48">\n                            <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>\n                            <path d="M10 16l5-3-5-3v6z" fill="#fff"/>\n                        </svg>\n                        <p>Slideshow Folder</p>\n                        <small>Package for end-users</small>\n                    </div>\n                    <div class="funshow-builder-download-option funshow-env-hide-if-local" data-type="dev">\n                        <svg viewBox="0 0 24 24" width="48" height="48">\n                            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>\n                        </svg>\n                        <p>Developer Build</p>\n                        <small>Full package for developers</small>\n                    </div>\n                </div>\n                <div class="funshow-builder-version-select funshow-builder-viewer-version-select funshow-env-hide-if-local">\n                    <select disabled>\n                        <option value="alpha">FunShow v0.0.1 ALPHA</option>\n                    </select>\n                    <label>\n                        <input type="checkbox" id="viewerInclude">\n                        Include\n                    </label>\n                </div>\n                <div class="funshow-builder-modal-buttons">\n                    <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="cancelDownload">\n                        <div class="funshow-builder-button-content">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <circle cx="12" cy="12" r="10"></circle>\n                                <path d="M15 9l-6 6"></path>\n                                <path d="M9 9l6 6"></path>\n                            </svg>\n                            Cancel\n                        </div>\n                    </button>\n                </div>\n            </div>\n        `;document.body.appendChild(modal);const downloadOptions=modal.querySelectorAll(".funshow-builder-download-option");downloadOptions.forEach((option=>{option.addEventListener("click",(async()=>{const downloadType=option.dataset.type;const viewerInclude=document.getElementById("viewerInclude").checked;this.showSpinner(modal);try{if(downloadType==="json"){await this.downloadJSON({viewerInclude:viewerInclude})}else{await this.packAndDownload({type:downloadType,viewerInclude:viewerInclude})}this.showSuccessMessage(modal,downloadType)}catch(error){this.showErrorMessage(modal,error)}}))}));document.getElementById("cancelDownload").addEventListener("click",(()=>{document.body.removeChild(modal)}))}showSpinner(modal){const content=modal.querySelector(".funshow-builder-modal-content");content.innerHTML=`\n            <div class="funshow-builder-spinner"></div>\n            <p>Please wait...</p>\n        `}showSuccessMessage(modal,downloadType){const content=modal.querySelector(".funshow-builder-modal-content");content.innerHTML=`\n            <h2>Success</h2>\n            <div class="funshow-checkmark-appear">\n                <svg class="funshow-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>\n                </svg>\n            </div>\n            <div style="margin-bottom: 40px;">\n                <p>Your content should be downloading.</p>\n                <p>Otherwise, use the button below to download it manually.</p>\n            </div>\n\n            <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="manualDownload">\n                <div class="funshow-builder-button-content">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n                        <polyline points="7 10 12 15 17 10"></polyline>\n                        <line x1="12" y1="15" x2="12" y2="3"></line>\n                    </svg>\n                    Manual Download\n                </div>\n            </button>\n            <button class="funshow-builder-modal-button funshow-builder-modal-button-primary" id="closeModal">\n                <div class="funshow-builder-button-content">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M20 6L9 17l-5-5"></path>\n                    </svg>\n                    OK\n                </div>\n            </button>\n        `;const funShowCheckmarkAppear=content.querySelector(".funshow-checkmark-appear");funShowCheckmarkAppear.offsetWidth;funShowCheckmarkAppear.style.opacity="1";document.getElementById("manualDownload").addEventListener("click",(()=>{if(downloadType==="json"){this.downloadJSON()}else{this.downloadDeveloper({type:downloadType})}}));document.getElementById("closeModal").addEventListener("click",(()=>{document.body.removeChild(modal)}))}showErrorMessage(modal,error){const content=modal.querySelector(".funshow-builder-modal-content");content.innerHTML=`\n            <h2>ERROR: Failed to build</h2>\n            <p>An error occurred during the build process:</p>\n            <pre>${error.message}</pre>\n            <button class="funshow-builder-modal-button funshow-builder-modal-button-secondary" id="closeModal">OK</button>\n        `;document.getElementById("closeModal").addEventListener("click",(()=>{document.body.removeChild(modal)}))}async generateJSON(resolveBlobs=true){const slideshowConfig=this.getSlideshowConfig();const slideElements=this.getSlides();const slideshow={config:{},slides:[]};for(const key in this.schema.slideshow.config){if(key in slideshowConfig){if(this.schema.slideshow.config[key].type==="range"){slideshow.config[key]=Number(slideshowConfig[key])}else{slideshow.config[key]=slideshowConfig[key]}}}slideshow.slides=slideElements.map((slideElement=>{const slide=slideElement.slide;const filteredSlide={};for(const key in this.schema.slide){if(key!=="config"&&key in slide){if(resolveBlobs&&key==="file"&&!slide[key].indexOf("blob:")&&(slide.handle||slide.directoryHandle)){if(slide.directoryHandle){filteredSlide[key]=`${slide.directoryHandle.name}/${slide.handle.name}`}else{filteredSlide[key]=slide.handle.name}}else{if(this.schema.slide[key].type==="range"){filteredSlide[key]=Number(slide[key])}else{filteredSlide[key]=slide[key]}}}}filteredSlide.config={};for(const key in this.schema.slide.config){const formGroup=slideElement.querySelector(`[data-property-ref="${key}"]`);if(formGroup){const checkbox=formGroup.querySelector(".funshow-builder-slide-config-checkbox");if(checkbox&&checkbox.checked&&key in slide.config){if(this.schema.slide.config[key].type==="range"){filteredSlide.config[key]=Number(slide.config[key])}else{filteredSlide.config[key]=slide.config[key]}}}}return filteredSlide}));return slideshow}async downloadJSON(){const slideshow=await this.generateJSON();const jsonString=JSON.stringify(slideshow,null,2);const blob=new Blob([jsonString],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=this.loadedFileName||"slideshow_config.json";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);this.loadedFileName=a.download;document.getElementById("fileNameDisplay").textContent=`Filename: ${this.loadedFileName}`;this.setInitialStateHash()}async packAndDownload({type:type,viewerInclude:viewerInclude}){await new Promise((resolve=>setTimeout(resolve,2e3)));throw new Error("Pack and download not implemented for "+type)}downloadDeveloper({type:type}){console.log("Downloading developer package for type:",type)}loadDefaultSlideshow(slides){const defaultSlideshow=window.funShowEnvironment.generateDefaultSlideshow();this.updateLastUsedPath(defaultSlideshow.config);this.renderSlideshowConfig(defaultSlideshow.config);this.renderSlides(slides??defaultSlideshow.slides);this.loadedFileName="slideshow_data.json";document.getElementById("fileNameDisplay").textContent="Filename: slideshow_data.json";const slideElements=document.querySelectorAll(".funshow-builder-slide");slideElements.forEach((slideElement=>{const configCheckboxes=slideElement.querySelectorAll(".funshow-builder-slide-config-checkbox");configCheckboxes.forEach((checkbox=>checkbox.checked=false))}));this.setInitialStateHash()}getSlideshowConfig(){const configContainer=document.getElementById("slideshowConfig");const config={};const formGroups=configContainer.querySelectorAll(".funshow-builder-form-group");formGroups.forEach((group=>{const input=group.querySelector("input, select, textarea");const propertyRef=group.dataset.propertyRef;let value=input.type==="checkbox"?input.checked:input.value;config[propertyRef]=value}));return config}getSlides(){const slideElements=document.querySelectorAll(".funshow-builder-slide");return Array.from(slideElements).map((slideElement=>{this.updateSlideFromForm(slideElement);return slideElement}))}showHelpFlyout(text){const flyout=document.getElementById("helpFlyout");flyout.textContent=text;flyout.style.opacity="1"}hideHelpFlyout(){const flyout=document.getElementById("helpFlyout");flyout.style.opacity="0"}createFormGroup(key,schema,value,isSlide=false,isConfigProperty=false){const formGroup=document.createElement("div");formGroup.className="funshow-builder-form-group";if(schema.help){formGroup.setAttribute("data-help",schema.help)}if(isSlide&&isConfigProperty){const checkbox=document.createElement("input");checkbox.type="checkbox";checkbox.className="funshow-builder-slide-config-checkbox";checkbox.checked=false;formGroup.appendChild(checkbox)}const label=document.createElement("label");label.textContent=schema.label||key;formGroup.appendChild(label);let input;switch(schema.type){case"dropdown":input=document.createElement("select");schema.options.forEach((option=>{const optionElement=document.createElement("option");optionElement.value=option.value;optionElement.textContent=option.label||option.value;if(option.value===value)optionElement.selected=true;input.appendChild(optionElement)}));break;case"checkbox":input=document.createElement("input");input.type="checkbox";input.checked=value;break;case"range":const rangeContainer=document.createElement("div");rangeContainer.style.display="flex";rangeContainer.style.alignItems="center";rangeContainer.style.flex="1";input=document.createElement("input");input.type="range";input.min=schema.min;input.max=schema.max;input.step=.01;input.value=value;if(isSlide){input.className="funshow-builder-slide-range"}const rangeValue=document.createElement("span");rangeValue.className="funshow-builder-range-value";rangeValue.textContent=Number(value).toFixed(2);input.addEventListener("input",(()=>rangeValue.textContent=Number(input.value).toFixed(2)));rangeContainer.appendChild(input);rangeContainer.appendChild(rangeValue);formGroup.appendChild(rangeContainer);break;case"color":input=document.createElement("input");input.type="color";input.value=value;break;case"textarea":input=document.createElement("textarea");input.value=value;input.rows=2;break;default:input=document.createElement("input");input.type="text";input.value=value}if(input.type!=="range"){formGroup.appendChild(input)}formGroup.dataset.objectRef=isSlide?isConfigProperty?"slide.config":"slide":"slideshow";formGroup.dataset.propertyRef=key;if(isSlide&&isConfigProperty){input.addEventListener("change",(()=>{const checkbox=formGroup.querySelector(".funshow-builder-slide-config-checkbox");checkbox.checked=true}))}return formGroup}renderSlideshowConfig(config){const configContainer=document.getElementById("slideshowConfig");configContainer.innerHTML="";for(const[key,value]of Object.entries(this.schema.slideshow.config)){const formGroup=this.createFormGroup(key,value,config[key]);configContainer.appendChild(formGroup)}const workingDirectoryInput=configContainer.querySelector('[data-property-ref="workingDirectory"] input');const contentPathInput=configContainer.querySelector('[data-property-ref="contentPath"] input');if(workingDirectoryInput){workingDirectoryInput.addEventListener("blur",(()=>this.updateSlidePreviews()));workingDirectoryInput.addEventListener("keypress",(e=>{if(e.key==="Enter"){e.preventDefault();workingDirectoryInput.blur()}}))}if(contentPathInput){contentPathInput.addEventListener("blur",(()=>this.updateSlidePreviews()));contentPathInput.addEventListener("keypress",(e=>{if(e.key==="Enter"){e.preventDefault();contentPathInput.blur()}}))}}dragEnter(e){e.preventDefault();if(e.target.classList.contains("funshow-builder-slide")&&!e.target.classList.contains("dragging")){e.target.classList.add("drag-over")}}dragOver(e){e.preventDefault()}dragLeave(e){e.target.classList.remove("drag-over")}addSlides(slidesToAdd,addToFront){const slidesContainer=document.getElementById("slidesContainer");const addSlideButton=slidesContainer.querySelector(".funshow-builder-add-slide-rear");const addSlideToFrontButton=slidesContainer.querySelector(".funshow-builder-add-slide-front");const slidesArray=addToFront?[...slidesToAdd].reverse():slidesToAdd;slidesArray.forEach((slide=>{const slideElement=this.createSlideElement(slide,this.getSlideCount());if(addToFront){addSlideToFrontButton.parentNode.insertBefore(slideElement,addSlideToFrontButton.nextSibling)}else{slidesContainer.insertBefore(slideElement,addSlideButton)}}));this.makeSlidesDraggable();this.updateSlideNumbers()}createAddSlideButton(){const addSlideButton=document.createElement("div");addSlideButton.className="funshow-builder-add-slide";this.applyBuilderZoomToSlideElement(addSlideButton);addSlideButton.addEventListener("click",(()=>this.addNewSlide(addSlideButton.classList.contains("funshow-builder-add-slide-front"))));const dragAndDropBuilder=new FunShowMediaLibraryDragAndDropBuilder({container:addSlideButton,modestStyle:true,autoDestruct:false,dropHTML:"+"});dragAndDropBuilder.on("ready",(items=>{const slides=this.processDroppedMediaLibrary(items).map((customSlide=>{const defaultSlide=window.funShowEnvironment.createDefaultSlide();return{...defaultSlide,...customSlide,config:{...defaultSlide.config,...customSlide.config}}}));this.addSlides(slides,addSlideButton.classList.contains("funshow-builder-add-slide-front"))}));return addSlideButton}renderSlides(slides){const slidesContainer=document.getElementById("slidesContainer");slidesContainer.innerHTML="";slidesContainer.classList.add("funshow-builder-slides-empty");const addSlideButtonFront=this.createAddSlideButton();addSlideButtonFront.classList.add("funshow-builder-hide-if-noslides","funshow-builder-add-slide-front");slidesContainer.appendChild(addSlideButtonFront);this.addSlides(slides);const addSlideButtonBack=this.createAddSlideButton();addSlideButtonBack.classList.add("funshow-builder-add-slide-rear");slidesContainer.appendChild(addSlideButtonBack)}processDroppedMediaLibrary(items){const funShowItems=[];const hasChildSlides=folderId=>Object.values(items).some((item=>item.parent===folderId&&(item.type==="image"||item.type==="video")));const addFolderAndFiles=folderId=>{const folder=items[folderId];if(hasChildSlides(folderId)){funShowItems.push({title:folder.name,type:"category"});for(const itemId in items){const item=items[itemId];if(item.parent===folderId&&(item.type==="image"||item.type==="video")){funShowItems.push({file:URL.createObjectURL(item.file),title:item.name,type:item.type,handle:item.file,directoryHandle:item.directory})}}}};for(const itemId in items){const item=items[itemId];if((item.type==="image"||item.type==="video")&&!item.parent){funShowItems.push({file:URL.createObjectURL(item.file),title:item.name,type:item.type,handle:item})}}for(const itemId in items){const item=items[itemId];if(item.type==="folder"&&!item.parent){addFolderAndFiles(itemId)}}return funShowItems}createSlideElement(slide,index){const slideElement=document.createElement("div");this.applyBuilderZoomToSlideElement(slideElement);slideElement.className="funshow-builder-slide funshow-builder-scrollable";slideElement.slide=slide;const slideInfoWrapper=document.createElement("div");slideInfoWrapper.style.position="relative";slideInfoWrapper.style.transform="translate(-19px, -19px)";const slideInfo=document.createElement("div");slideInfo.className="funshow-builder-slide-info";const slideNumber=document.createElement("div");slideNumber.className="funshow-builder-slide-number";slideNumber.textContent=index+1;slideInfo.appendChild(slideNumber);const slideInfoActions=document.createElement("div");slideInfoActions.className="funshow-builder-slide-info-actions";slideInfo.appendChild(slideInfoActions);const editIcon=document.createElementNS("http://www.w3.org/2000/svg","svg");editIcon.setAttribute("class","funshow-builder-slide-edit-icon");editIcon.setAttribute("width","16");editIcon.setAttribute("height","16");editIcon.setAttribute("viewBox","0 0 16 16");editIcon.innerHTML='<path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>';slideInfoActions.appendChild(editIcon);const deleteIcon=document.createElementNS("http://www.w3.org/2000/svg","svg");deleteIcon.setAttribute("class","funshow-builder-slide-delete-icon");deleteIcon.setAttribute("width","16");deleteIcon.setAttribute("height","16");deleteIcon.setAttribute("viewBox","0 0 16 16");deleteIcon.innerHTML='<path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>';slideInfoActions.appendChild(deleteIcon);slideInfoWrapper.appendChild(slideInfo);slideElement.appendChild(slideInfoWrapper);const previewElement=document.createElement("div");previewElement.className="funshow-builder-slide-preview";this.updateSlidePreview(slide,previewElement);slideElement.appendChild(previewElement);const editContent=document.createElement("div");editContent.className="funshow-builder-slide-edit-content";for(const[key,value]of Object.entries(this.schema.slide)){if(key!=="config"){const formGroup=this.createFormGroup(key,value,slide[key],true);editContent.appendChild(formGroup)}}const configTitle=document.createElement("h4");configTitle.textContent="Slide Config";editContent.appendChild(configTitle);for(const[key,schema]of Object.entries(this.schema.slide.config)){const formGroup=this.createFormGroup(key,schema,slide.config[key],true,true);const checkbox=formGroup.querySelector(".funshow-builder-slide-config-checkbox");if(checkbox&&slide.config[key]!=schema.default){checkbox.checked=key in slide.config}editContent.appendChild(formGroup)}slideElement.appendChild(editContent);const deleteConfirmation=document.createElement("div");deleteConfirmation.className="funshow-builder-slide-delete-confirmation";deleteConfirmation.innerHTML=`\n            <div>Delete - are you sure?</div>\n            <div class="funshow-builder-delete-confirm-buttons">\n                <button class="funshow-builder-delete-confirm-button funshow-builder-delete-confirm-yes">Yes</button>\n                <button class="funshow-builder-delete-confirm-button funshow-builder-delete-confirm-cancel">Cancel</button>\n            </div>\n        `;slideElement.appendChild(deleteConfirmation);return slideElement}setCheckboxes(slideElement){const slide=slideElement.slide;const configCheckboxes=slideElement.querySelectorAll(".funshow-builder-slide-config-checkbox");configCheckboxes.forEach((checkbox=>{const propertyRef=checkbox.closest(".funshow-builder-form-group").dataset.propertyRef;checkbox.checked=slide.config?propertyRef in slide.config:false}))}addNewSlide(addToFront){const newSlide=window.funShowEnvironment.createDefaultSlide();if(newSlide.type=="html"){newSlide.title="My Slide";newSlide.file='<div style="font-size: min(10vh, 10vw);">Content</div>'}const slideElement=this.createSlideElement(newSlide,this.getSlideCount());delete newSlide.config;this.setCheckboxes(slideElement);const slidesContainer=document.getElementById("slidesContainer");if(addToFront){slidesContainer.insertBefore(slideElement,slidesContainer.firstElementChild.nextSibling)}else{slidesContainer.insertBefore(slideElement,slidesContainer.lastElementChild)}this.makeSlidesDraggable();this.updateSlideNumbers()}deleteSlide(e){const slide=e.currentTarget.closest(".funshow-builder-slide");slide.remove();this.updateSlideNumbers()}getSlideCount(){return document.querySelectorAll(".funshow-builder-slide").length}updateSlideNumbers(){const slides=document.querySelectorAll(".funshow-builder-slide");slides.forEach(((slide,index)=>{const slideNumber=slide.querySelector(".funshow-builder-slide-number");slideNumber.textContent=index+1}));if(slides.length>0){slidesContainer.classList.remove("funshow-builder-slides-empty")}else{slidesContainer.classList.add("funshow-builder-slides-empty")}}makeSlidesDraggable(){const slides=document.querySelectorAll(".funshow-builder-slide");slides.forEach((slide=>{if(slide.draggable){return}slide.draggable=true;slide.addEventListener("mousedown",this.slideMouseDown.bind(this));slide.addEventListener("dragstart",this.dragStart.bind(this));slide.addEventListener("dragenter",this.dragEnter.bind(this));slide.addEventListener("dragover",this.dragOver.bind(this));slide.addEventListener("dragleave",this.dragLeave.bind(this));slide.addEventListener("drop",this.drop.bind(this));slide.addEventListener("dragend",this.dragEnd.bind(this));if(!slide.hasEditListeners){slide.hasEditListeners=true;const editIcon=slide.querySelector(".funshow-builder-slide-edit-icon");editIcon.addEventListener("click",this.toggleSlideEdit.bind(this));const deleteIcon=slide.querySelector(".funshow-builder-slide-delete-icon");deleteIcon.addEventListener("click",this.toggleSlideDeleteConfirmation.bind(this));const deleteConfirmYes=slide.querySelector(".funshow-builder-delete-confirm-yes");deleteConfirmYes.addEventListener("click",this.deleteSlide.bind(this));const deleteConfirmCancel=slide.querySelector(".funshow-builder-delete-confirm-cancel");deleteConfirmCancel.addEventListener("click",this.toggleSlideDeleteConfirmation.bind(this))}}))}toggleSlideEdit(e){const slide=e.currentTarget.closest(".funshow-builder-slide");slide.classList.toggle("funshow-builder-edit");if(!slide.classList.contains("funshow-builder-edit")){this.updateSlideFromForm(slide)}}toggleSlideDeleteConfirmation(e){const slide=e.currentTarget.closest(".funshow-builder-slide");slide.classList.toggle("funshow-builder-delete-confirm")}deleteSlide(e){const slide=e.currentTarget.closest(".funshow-builder-slide");slide.remove();this.updateSlideNumbers()}updateSlideFromForm(slideElement){const slideData=this.getSlideDataFromForm(slideElement);Object.assign(slideElement.slide,slideData);this.updateSlidePreview(slideElement.slide,slideElement.querySelector(".funshow-builder-slide-preview"))}getSlideDataFromForm(slideElement){const slideData={config:{}};const formGroups=slideElement.querySelectorAll(".funshow-builder-form-group");formGroups.forEach((group=>{const input=group.querySelector("input:not(.funshow-builder-slide-config-checkbox), select, textarea");const propertyRef=group.dataset.propertyRef;let value=input.type==="checkbox"?input.checked:input.value;if(group.dataset.objectRef==="slide.config"){const checkbox=group.querySelector(".funshow-builder-slide-config-checkbox");if(checkbox&&checkbox.checked){slideData.config[propertyRef]=value}}else if(group.dataset.objectRef==="slide"){slideData[propertyRef]=value}}));return slideData}calculatePath(){const workingDirectoryInput=document.querySelector('[data-property-ref="workingDirectory"] input');const contentPathInput=document.querySelector('[data-property-ref="contentPath"] input');let path=workingDirectoryInput&&workingDirectoryInput.value!==""?workingDirectoryInput.value:contentPathInput&&contentPathInput.value!==""?contentPathInput.value:"";path=path.replace(/\\/g,"/");if(path&&!path.endsWith("/")){path+="/"}return path}updateSlidePreviews(){const newPath=this.calculatePath();if(newPath!==this.lastUsedPath){this.lastUsedPath=newPath;const slides=document.querySelectorAll(".funshow-builder-slide");slides.forEach((slide=>{const previewElement=slide.querySelector(".funshow-builder-slide-preview");this.updateSlidePreview(slide.slide,previewElement)}))}}updateSlidePreview(slideData,previewElement){const pathToUse=slideData.file.indexOf("blob:")!=0||!slideData.handle?this.lastUsedPath:"";const mediaUrl=`${pathToUse}${slideData.file}`;const typeOption=this.schema.slide.type.options.find((option=>option.value===slideData.type));const typeLabel=typeOption?typeOption.label:"Other";previewElement.innerHTML=`<div>${typeLabel}</div>`;if(slideData.title){const titleElement=document.createElement("div");titleElement.textContent=slideData.title;titleElement.style.fontSize="16px";titleElement.style.marginTop="10px";previewElement.appendChild(titleElement)}if(slideData.type==="image"){previewElement.style.backgroundImage=`url("${mediaUrl}")`}}slideMouseDown(e){if(e.target.tagName==="INPUT"||e.target.tagName==="SELECT"||e.target.tagName==="TEXTAREA"){e.stopPropagation();e.target.closest(".funshow-builder-slide").draggable=false}else{e.target.closest(".funshow-builder-slide").draggable=true}}dragStart(e){this.activeDraggedElement=e.target;e.dataTransfer.setData("text/plain","active-dragged-object");e.target.classList.add("dragging")}drop(e){e.preventDefault();const id=e.dataTransfer.getData("text");const draggableElement=this.activeDraggedElement;const dropzone=e.target.closest(".funshow-builder-slide");if(dropzone&&draggableElement!==dropzone){const container=dropzone.parentNode;const draggableIndex=Array.from(container.children).indexOf(draggableElement);const dropzoneIndex=Array.from(container.children).indexOf(dropzone);if(draggableIndex<dropzoneIndex){container.insertBefore(draggableElement,dropzone.nextSibling)}else{container.insertBefore(draggableElement,dropzone)}this.updateSlideNumbers()}this.dragEnd(e)}dragEnd(e){const slides=document.querySelectorAll(".funshow-builder-slide");slides.forEach((slide=>{slide.classList.remove("dragging");slide.classList.remove("drag-over");slide.draggable=true}))}}